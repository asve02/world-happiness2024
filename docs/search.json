[
  {
    "objectID": "analysis/hapiness-analysis.html",
    "href": "analysis/hapiness-analysis.html",
    "title": "World Happiness Analysis-Kaggle dataset",
    "section": "",
    "text": "Show code\n#List of required packages\n\npackages &lt;- c(\"tidyverse\", \"readxl\", \"janitor\", \"broom\", \"plotly\", \"countrycode\")\n\n#Install missing packages\n\nfor (pkg in packages) {\nif (!require(pkg, character.only = TRUE)) {\ninstall.packages(pkg)\n}\n}\n\n#Load all packages\n\nlapply(packages, library, character.only = TRUE)\n\n\n[[1]]\n [1] \"countrycode\" \"plotly\"      \"broom\"       \"janitor\"     \"readxl\"     \n [6] \"lubridate\"   \"forcats\"     \"stringr\"     \"dplyr\"       \"purrr\"      \n[11] \"readr\"       \"tidyr\"       \"tibble\"      \"ggplot2\"     \"tidyverse\"  \n[16] \"stats\"       \"graphics\"    \"grDevices\"   \"utils\"       \"datasets\"   \n[21] \"methods\"     \"base\"       \n\n[[2]]\n [1] \"countrycode\" \"plotly\"      \"broom\"       \"janitor\"     \"readxl\"     \n [6] \"lubridate\"   \"forcats\"     \"stringr\"     \"dplyr\"       \"purrr\"      \n[11] \"readr\"       \"tidyr\"       \"tibble\"      \"ggplot2\"     \"tidyverse\"  \n[16] \"stats\"       \"graphics\"    \"grDevices\"   \"utils\"       \"datasets\"   \n[21] \"methods\"     \"base\"       \n\n[[3]]\n [1] \"countrycode\" \"plotly\"      \"broom\"       \"janitor\"     \"readxl\"     \n [6] \"lubridate\"   \"forcats\"     \"stringr\"     \"dplyr\"       \"purrr\"      \n[11] \"readr\"       \"tidyr\"       \"tibble\"      \"ggplot2\"     \"tidyverse\"  \n[16] \"stats\"       \"graphics\"    \"grDevices\"   \"utils\"       \"datasets\"   \n[21] \"methods\"     \"base\"       \n\n[[4]]\n [1] \"countrycode\" \"plotly\"      \"broom\"       \"janitor\"     \"readxl\"     \n [6] \"lubridate\"   \"forcats\"     \"stringr\"     \"dplyr\"       \"purrr\"      \n[11] \"readr\"       \"tidyr\"       \"tibble\"      \"ggplot2\"     \"tidyverse\"  \n[16] \"stats\"       \"graphics\"    \"grDevices\"   \"utils\"       \"datasets\"   \n[21] \"methods\"     \"base\"       \n\n[[5]]\n [1] \"countrycode\" \"plotly\"      \"broom\"       \"janitor\"     \"readxl\"     \n [6] \"lubridate\"   \"forcats\"     \"stringr\"     \"dplyr\"       \"purrr\"      \n[11] \"readr\"       \"tidyr\"       \"tibble\"      \"ggplot2\"     \"tidyverse\"  \n[16] \"stats\"       \"graphics\"    \"grDevices\"   \"utils\"       \"datasets\"   \n[21] \"methods\"     \"base\"       \n\n[[6]]\n [1] \"countrycode\" \"plotly\"      \"broom\"       \"janitor\"     \"readxl\"     \n [6] \"lubridate\"   \"forcats\"     \"stringr\"     \"dplyr\"       \"purrr\"      \n[11] \"readr\"       \"tidyr\"       \"tibble\"      \"ggplot2\"     \"tidyverse\"  \n[16] \"stats\"       \"graphics\"    \"grDevices\"   \"utils\"       \"datasets\"   \n[21] \"methods\"     \"base\"       \n\n\n\n\nShow code\n#Q1:Read happiness dataset (use \"Alt + -\" for &lt;-)\n\nhappiness &lt;- read_excel(\"../data/happiness.xlsx\")\n\n#Quick look at the data\n\nglimpse(happiness)\n\n\nRows: 2,363\nColumns: 11\n$ `Country name`                     &lt;chr&gt; \"Afghanistan\", \"Afghanistan\", \"Afgh…\n$ year                               &lt;dbl&gt; 2008, 2009, 2010, 2011, 2012, 2013,…\n$ `Life Ladder`                      &lt;dbl&gt; 3.724, 4.402, 4.758, 3.832, 3.783, …\n$ `Log GDP per capita`               &lt;dbl&gt; 7.350, 7.509, 7.614, 7.581, 7.661, …\n$ `Social support`                   &lt;dbl&gt; 0.451, 0.552, 0.539, 0.521, 0.521, …\n$ `Healthy life expectancy at birth` &lt;dbl&gt; 50.500, 50.800, 51.100, 51.400, 51.…\n$ `Freedom to make life choices`     &lt;dbl&gt; 0.718, 0.679, 0.600, 0.496, 0.531, …\n$ Generosity                         &lt;dbl&gt; 0.164, 0.187, 0.118, 0.160, 0.234, …\n$ `Perceptions of corruption`        &lt;dbl&gt; 0.882, 0.850, 0.707, 0.731, 0.776, …\n$ `Positive affect`                  &lt;dbl&gt; 0.414, 0.481, 0.517, 0.480, 0.614, …\n$ `Negative affect`                  &lt;dbl&gt; 0.258, 0.237, 0.275, 0.267, 0.268, …\n\n\nShow code\ncolnames(happiness)\n\n\n [1] \"Country name\"                     \"year\"                            \n [3] \"Life Ladder\"                      \"Log GDP per capita\"              \n [5] \"Social support\"                   \"Healthy life expectancy at birth\"\n [7] \"Freedom to make life choices\"     \"Generosity\"                      \n [9] \"Perceptions of corruption\"        \"Positive affect\"                 \n[11] \"Negative affect\"                 \n\n\n\n\nShow code\n#we see that each column names appear with space between them, lets put \"_\" in place of space \n\nhappiness &lt;- read_excel(\"../data/happiness.xlsx\") |&gt;\n  clean_names()\n\n#check if the column names got cleaned (check structure using glimpse)\nglimpse(happiness)\n\n\nRows: 2,363\nColumns: 11\n$ country_name                     &lt;chr&gt; \"Afghanistan\", \"Afghanistan\", \"Afghan…\n$ year                             &lt;dbl&gt; 2008, 2009, 2010, 2011, 2012, 2013, 2…\n$ life_ladder                      &lt;dbl&gt; 3.724, 4.402, 4.758, 3.832, 3.783, 3.…\n$ log_gdp_per_capita               &lt;dbl&gt; 7.350, 7.509, 7.614, 7.581, 7.661, 7.…\n$ social_support                   &lt;dbl&gt; 0.451, 0.552, 0.539, 0.521, 0.521, 0.…\n$ healthy_life_expectancy_at_birth &lt;dbl&gt; 50.500, 50.800, 51.100, 51.400, 51.70…\n$ freedom_to_make_life_choices     &lt;dbl&gt; 0.718, 0.679, 0.600, 0.496, 0.531, 0.…\n$ generosity                       &lt;dbl&gt; 0.164, 0.187, 0.118, 0.160, 0.234, 0.…\n$ perceptions_of_corruption        &lt;dbl&gt; 0.882, 0.850, 0.707, 0.731, 0.776, 0.…\n$ positive_affect                  &lt;dbl&gt; 0.414, 0.481, 0.517, 0.480, 0.614, 0.…\n$ negative_affect                  &lt;dbl&gt; 0.258, 0.237, 0.275, 0.267, 0.268, 0.…\n\n\nShow code\ncolnames(happiness)\n\n\n [1] \"country_name\"                     \"year\"                            \n [3] \"life_ladder\"                      \"log_gdp_per_capita\"              \n [5] \"social_support\"                   \"healthy_life_expectancy_at_birth\"\n [7] \"freedom_to_make_life_choices\"     \"generosity\"                      \n [9] \"perceptions_of_corruption\"        \"positive_affect\"                 \n[11] \"negative_affect\"                 \n\n\n\n\nShow code\n#Q2: Which countries and years included in the dataset?\n#Q2.1: Unique list of countries\nhappiness |&gt;\n  distinct(country_name) |&gt; #distinct() finds unique values\n  arrange(country_name) #arrange() sorts alphabetically\n\n\n# A tibble: 165 × 1\n   country_name\n   &lt;chr&gt;       \n 1 Afghanistan \n 2 Albania     \n 3 Algeria     \n 4 Angola      \n 5 Argentina   \n 6 Armenia     \n 7 Australia   \n 8 Austria     \n 9 Azerbaijan  \n10 Bahrain     \n# ℹ 155 more rows\n\n\nShow code\n#Q2.2: Unique list of years\nhappiness |&gt;\n  distinct(year) |&gt; #distinct() finds unique values\n  arrange(year)\n\n\n# A tibble: 19 × 1\n    year\n   &lt;dbl&gt;\n 1  2005\n 2  2006\n 3  2007\n 4  2008\n 5  2009\n 6  2010\n 7  2011\n 8  2012\n 9  2013\n10  2014\n11  2015\n12  2016\n13  2017\n14  2018\n15  2019\n16  2020\n17  2021\n18  2022\n19  2023\n\n\n\n\nShow code\n#Q3: How many years of data does each country have?\nhappiness |&gt;\n  count(country_name, sort = TRUE) #sort used to sort result in descending order\n\n\n# A tibble: 165 × 2\n   country_name     n\n   &lt;chr&gt;        &lt;int&gt;\n 1 Argentina       18\n 2 Bangladesh      18\n 3 Bolivia         18\n 4 Brazil          18\n 5 Cambodia        18\n 6 Cameroon        18\n 7 Canada          18\n 8 Chile           18\n 9 Colombia        18\n10 Costa Rica      18\n# ℹ 155 more rows\n\n\n\n\nShow code\n#Q4: What is the average Life Ladder (happiness score) for each year?\nhappiness |&gt;\n  group_by(year) |&gt;\n  summarise(\n    mean_happiness = mean(life_ladder, na.rm = TRUE),\n    n_countries = n()\n    ) |&gt;\n  arrange(year)\n\n\n# A tibble: 19 × 3\n    year mean_happiness n_countries\n   &lt;dbl&gt;          &lt;dbl&gt;       &lt;int&gt;\n 1  2005           6.45          27\n 2  2006           5.20          89\n 3  2007           5.42         102\n 4  2008           5.42         110\n 5  2009           5.46         114\n 6  2010           5.50         124\n 7  2011           5.42         146\n 8  2012           5.44         141\n 9  2013           5.39         136\n10  2014           5.39         144\n11  2015           5.40         142\n12  2016           5.40         141\n13  2017           5.46         147\n14  2018           5.50         141\n15  2019           5.57         143\n16  2020           5.73         116\n17  2021           5.64         122\n18  2022           5.50         140\n19  2023           5.62         138\n\n\nShow code\n#summarise(): calculates summary values inside each group\n#na.rm = TRUE: removes missing values\n\n\n\n\nShow code\n#Q5: What is the global happiness trend over time? (Line plot)\n#To answer that, for each year we need one number: the mean Life Ladder across all countries that have data in that year.\n\n#Calculate global mean happiness per year\nhappiness_yearly &lt;- happiness |&gt;\ngroup_by(year) |&gt;\nsummarise(\nmean_happiness = mean(life_ladder, na.rm = TRUE)\n)\n\n\n\n\nShow code\n#plot\nhappiness_yearly |&gt;\nggplot(aes(x = year, y = mean_happiness)) +\ngeom_line(linewidth = 1.2) +\ngeom_point(size = 2) +\nlabs(\ntitle = \"Global Happiness Trend Over Time\",\nx = \"Year\",\ny = \"Average Life Ladder (Happiness Score)\"\n)\n\n\n\n\n\n\n\n\n\n\n\nShow code\n#Q6: Which countries are the happiest on average across all years?\ncountry_means &lt;- happiness |&gt;\n  group_by(country_name) |&gt;\n  summarise(\n    mean_happiness = mean(life_ladder, na.rm = TRUE),\n    n_years = n()\n  ) |&gt;\n  arrange(desc(mean_happiness))\n\n#show top 10 happinest counntries\nhead(country_means, 10)\n\n\n# A tibble: 10 × 3\n   country_name mean_happiness n_years\n   &lt;chr&gt;                 &lt;dbl&gt;   &lt;int&gt;\n 1 Denmark                7.66      18\n 2 Finland                7.62      16\n 3 Iceland                7.47      11\n 4 Norway                 7.46      13\n 5 Netherlands            7.44      17\n 6 Switzerland            7.44      13\n 7 Sweden                 7.37      18\n 8 Canada                 7.30      18\n 9 New Zealand            7.26      17\n10 Australia              7.24      17\n\n\n\n\nShow code\n#Q6.1: A bar plot of top 10 happiest countries?\ntop10_countries &lt;- country_means |&gt;\n  slice_head(n = 10)\n\n#Plot bar chart of top 10 happiest countries\ntop10_countries |&gt;\nggplot(aes(x = reorder(country_name, mean_happiness), \ny = mean_happiness)) +\ngeom_col() +\n  coord_flip()+\nlabs(\ntitle = \"Top 10 Happiest Countries (Average Life Ladder)\",\nx = \"Country\",\ny = \"Average Happiness Score\"\n)\n\n\n\n\n\n\n\n\n\nShow code\n#aes(x = reorder(country_name, mean_happiness), y = mean_happiness)\n#reorder(x, y) tells R: “Sort x according to y.”\n#“Take country_name and reorder it based on the values of mean_happiness.”\n#Because in a bar plot: The height of the bar is determined by y\n#The position/order of the bars is determined by x\n#So sorting must be applied to x, not y.\n#geom_col(): draw bars where height = y value.This is used when you already have a summary value (like mean), not raw counts.\n#coord_flip(): swaps x and y axes: countries go on the vertical axis\n#bars extend horizontally. This is much easier to read when we have long country names.\n\n\n\n\nShow code\n#A barplot of bottom 10 countries\nbottom_10_countries &lt;- country_means |&gt;\n  slice_tail(n = 10)\n#plot barchart of bottom 10 countries\nbottom_10_countries |&gt;\n  ggplot(aes(x = reorder(country_name, mean_happiness),\n             y = mean_happiness))+\n  geom_col()+\n  coord_flip()+\n  labs(\n    title = \"Bottom 10 happiest countries (Average Life Ladder)\",\n    x = \"Country\",\n    y = \"Average Happiness Score\"\n  )\n\n\n\n\n\n\n\n\n\n\n\nShow code\n#Q7: How does GDP relate to happiness?\n#(Happiness = Life Ladder, GDP = Log GDP per capita)\n\n#Step 1: Prepare data (remove missing values)\n\ngdp_data &lt;- happiness |&gt;\ndrop_na(life_ladder, log_gdp_per_capita) \n\n#drop_na() ensures that only rows with complete values are kept\n\n#Step 2: Scatter plot of GDP vs Happiness\n\ngdp_data |&gt;\nggplot(aes(x = log_gdp_per_capita, y = life_ladder)) +\ngeom_point(alpha = 0.4) + #alpha = 0.4 makes points semi-transparent so dense areas become visible\ngeom_smooth(method = \"lm\", se = TRUE) +\nlabs(\ntitle = \"Relationship Between GDP and Happiness\",\nx = \"Log GDP per capita\",\ny = \"Life Ladder (Happiness Score)\"\n)\n\n\n\n\n\n\n\n\n\nShow code\n#method = \"lm\" fits a straight line (linear model)\n#se = TRUE adds a shaded confidence interval → uncertainty around the line\n\n\n\n\nShow code\n#Q7.1: lets try to mention the linear regression equation on the plot\n\n#Step 1: Clean data\n\ngdp_data &lt;- happiness |&gt;\ndrop_na(life_ladder, log_gdp_per_capita)\n\n#Step 2: Fit linear model (Happiness = Intercept + Slope × LogGDP)\n#even if one is missing, that row can't be used\n\nmodel &lt;- lm(life_ladder ~  log_gdp_per_capita, data = gdp_data)\n\n#Step 3: Extract coefficients and R²\nmodel_stats &lt;- tidy(model) #this returns a table of statistics of regression table (row1 = intercept (constant term); row2: slope (coefficient of log GDP))\nmodel_glance &lt;- glance(model) #extract  R2\n\n#store these statistics value\nintercept &lt;- round(model_stats$estimate[1], 2) #till 2 decimenl places\nslope &lt;- round(model_stats$estimate[2], 2)\nr2 &lt;- round(model_glance$r.squared, 2)\n\n#build equation text\neq_text &lt;- paste0( \n\"Happiness = \", intercept, \" + \", slope, \" × logGDP\\n\",\n\"R² = \", r2\n)\n\n#paste0(): It concatenates strings without spaces unless we add them manually.\n#Step 4: Plot with regression line + equation\n\ngdp_data |&gt;\nggplot(aes(log_gdp_per_capita, life_ladder)) +\ngeom_point(alpha = 0.4) +\ngeom_smooth(method = \"lm\", se = TRUE) +\nannotate(\n\"text\", #We want to draw text, not shapes or lines.\nx = max(gdp_data$log_gdp_per_capita) * 0.6, #Place the equation 60% across the x-axis (right side but not too far).\ny = max(gdp_data$life_ladder) * 0.95, #Place it 95% up the y-axis (near the top)\nlabel = eq_text, #This is the formatted equation + R²\nhjust = 0, #Left-align the text (so it doesn’t look squeezed).\nsize = 4\n) +\nlabs(\ntitle = \"GDP vs Happiness with Regression Equation\",\nx = \"Log GDP per capita\",\ny = \"Life Ladder (Happiness Score)\"\n)\n\n\n\n\n\n\n\n\n\n\n\nShow code\n# Prepare data for mapping\nhappiness_map &lt;- happiness |&gt;\n  mutate( \n    iso3 = countrycode(country_name, \"country.name\", \"iso3c\")\n  ) |&gt;\n  drop_na(iso3, life_ladder) #remove rows where iso3 code and life_ladder missing\n\n# Build interactive world map with year slider\nfig &lt;- happiness_map |&gt;\n  plot_ly(  #plotly interactive plot\n    locations = ~iso3, #Draw a country based on its ISO3 code\n    z = ~life_ladder, #This determines the color shading of each country.\n    frame = ~year, #created the year slider, one map per year\n    type = \"choropleth\", #A choropleth map meanswhere each country is shaded based on the value of a variable\n    color = ~life_ladder, #Use Life Ladder values to determine the map color.\n    colorscale = \"Viridis\" #color-blind friendly\n  ) |&gt;\n  colorbar(title = \"Life Ladder\") |&gt; #Adds a legend on the right showing the mapping between color and happiness score.\n  layout( #Controls the visual layout\n    title = \"World Happiness Over Time\",\n    geo = list(showframe = FALSE, showcoastlines = FALSE)) #no border frames and coastlines\n\nfig\n\n\n\n\n\n\nShow code\n##We take the original happiness dataset and add a new column called iso3\n#Plotly requires ISO3 codes in the locations argument."
  }
]